<div class="property-approval-container">
  <header class="page-header">
    <div class="header-content">
      <h1>Property Approval</h1>
      <p>Review and manage property listings submitted by owners</p>
    </div>
  </header>

  <!-- Filter tabs -->
  <div class="filter-tabs">
    <button
      [class.active]="activeFilter === 'pending'"
      (click)="applyFilter('pending')"
    >
      Pending Approval
    </button>
    <button
      [class.active]="activeFilter === 'approved'"
      (click)="applyFilter('approved')"
    >
      Approved
    </button>
    <button
      [class.active]="activeFilter === 'all'"
      (click)="applyFilter('all')"
    >
      All Properties
    </button>
  </div>

  <!-- Loading state -->
  <div *ngIf="loading" class="loading-container">
    <div class="spinner"></div>
    <p>Loading properties...</p>
  </div>

  <!-- Error state -->
  <div *ngIf="error && !loading" class="error-container">
    <div class="error-message">
      <i class="fa fa-exclamation-circle"></i>
      <p>{{ error }}</p>
    </div>
    <button (click)="loadProperties()" class="btn-retry">Try Again</button>
  </div>

  <!-- Empty state -->
  <div
    *ngIf="!loading && !error && filteredProperties.length === 0"
    class="empty-container"
  >
    <div class="empty-state">
      <i class="fa fa-home"></i>
      <h2>No Properties Found</h2>
      <p *ngIf="activeFilter === 'pending'">
        There are no properties pending approval at this time.
      </p>
      <p *ngIf="activeFilter === 'approved'">
        There are no approved properties to display.
      </p>
      <p *ngIf="activeFilter === 'all'">
        There are no properties in the system.
      </p>
    </div>
  </div>

  <!-- Property listings -->
  <div
    *ngIf="!loading && !error && filteredProperties.length > 0"
    class="properties-list"
  >
    <div class="property-card" *ngFor="let property of filteredProperties">
      <div class="property-image">
        <img
          [src]="
            property.images && property.images.length > 0
              ? property.images[0]
              : 'assets/images/property-placeholder.jpg'
          "
          [alt]="property.title"
          class="main-image"
        />
        <div
          class="status-badge"
          [ngClass]="property.isApproved ? 'badge-approved' : 'badge-pending'"
        >
          {{ property.isApproved ? "Approved" : "Pending Approval" }}
        </div>
      </div>
      <div class="property-info">
        <h3 class="property-title">{{ property.title }}</h3>
        <p class="property-address">
          <i class="fa fa-map-marker-alt"></i>
          {{ property.address.city }}, {{ property.address.state }}
        </p>
        <div class="property-details">
          <span>
            <i class="fa fa-money-bill"></i>
            {{ property.price | currency }}
          </span>
          <span><i class="fa fa-bed"></i> {{ property.bedrooms }} bed</span>
          <span><i class="fa fa-bath"></i> {{ property.bathrooms }} bath</span>
          <span>
            <i class="fa fa-ruler-combined"></i> {{ property.area }} mÂ²
          </span>
        </div>

        <div class="owner-info" *ngIf="property.host">
          <p>
            <strong>Owner:</strong>
            {{ property.host.name || "Unknown" }} ({{
              property.host.email || "No email"
            }})
          </p>
        </div>
      </div>
      <div class="property-actions">
        <a
          [routerLink]="['/properties', property._id]"
          class="btn-view"
          target="_blank"
        >
          <i class="fa fa-eye"></i> View Details
        </a>

        <!-- Action buttons for pending properties -->
        <div *ngIf="!property.isApproved" class="approval-actions">
          <button
            (click)="approveProperty(property._id || '')"
            class="btn-approve"
          >
            <i class="fa fa-check"></i> Approve
          </button>
          <button
            (click)="rejectProperty(property._id || '')"
            class="btn-reject"
          >
            <i class="fa fa-times"></i> Decline
          </button>
        </div>

        <!-- Show unreject button for approved properties -->
        <button
          *ngIf="property.isApproved"
          (click)="rejectProperty(property._id || '')"
          class="btn-reject"
        >
          <i class="fa fa-ban"></i> Revoke Approval
        </button>
      </div>
    </div>
  </div>
</div>
